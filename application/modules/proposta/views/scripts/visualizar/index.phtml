<div id="container" class="container">
    <salic-identificacao-proposta idpreprojeto="<?= $this->idPreProjeto; ?>"></salic-identificacao-proposta>

    <ul class="collapsible" data-collapsible="accordion">
        <li>
            <div class="collapsible-header"><i class="material-icons">filter_drama</i>Hist&oacute;rico</div>
            <div class="collapsible-body">
                <salic-historico-avaliacoes idpreprojeto="<?= $this->idPreProjeto; ?>"></salic-historico-avaliacoes>
            </div>
        </li>
        <li>
            <div class="collapsible-header"><i class="material-icons">alert</i>Proponente</div>
            <div class="collapsible-body">
<!--                <salic-dados-proponente idpreprojeto="--><?//= $this->idPreProjeto; ?><!--"-->
<!--                                        idagente="--><?//= $this->proposta['idagente']; ?><!--"></salic-dados-proponente>-->
            </div>
        </li>
    </ul>
</div>

<script type="text/x-template" id="identificacao-da-proposta">
    <div class="dados-basicos">
        <div class="section">
            <h5>Identifica&ccedil;&atilde;o</h5>
            <div class="row">
                <div class="col s12 l3 m3">
                    <b>Nº da proposta</b><br>
                    {{ proposta.idpreprojeto }}
                </div>
                <div class="col s12 l3 m3">
                    <b>Pronac</b><br>
                    {{ proposta.pronac }}
                </div>
                <div class="col s12 l3 m6">
                    <b>Nome Projeto</b><br>
                    {{ proposta.nomeprojeto }}
                </div>
            </div>
        </div>
        <div class="section">
            <h5>Informa&ccedil;&otilde;es complementares</h5>
            <div class="row">
                <div class="col s12 l3 m3">
                    <b>Mecanismo</b><br>
                    {{ proposta.mecanismo }}
                </div>
                <div class="col s12 l3 m3">
                    <b>In&iacute;cio Execu&ccedil;&atilde;o</b><br>
                    {{ proposta.dtiniciodeexecucaoform }}
                </div>
                <div class="col s12 l3 m3">
                    <b>Final Execu&ccedil;&atilde;o</b><br>
                    {{ proposta.dtfinaldeexecucaoform }}
                </div>
                <div class="col s12 l3 m3">
                    <b>Dt. Fixa</b><br>
                    {{ proposta.stdatafixa}}
                </div>
            </div>
            <div class="divider"></div>
            <div class="row">
                <div class="col s12 l3 m3">
                    <b>Ag&ecirc;ncia banc&aacute;ria</b><br>
                    {{ proposta.agenciabancaria }}
                </div>
                <div class="col s12 l3 m3">
                    <b>É proposta audiovisual</b><br>
                    {{ proposta.areaabrangencia }}
                </div>
                <div class="col s12 l3 m3">
                    <b>Prorroga&ccedil;&atilde;o autom&aacute;tica</b><br>
                    {{ proposta.tpprorrogacao }}
                </div>
                <div class="col s12 l3 m3">
                    <b>Tipo de execu&ccedil;&atilde;o</b><br>
                    {{ proposta.stproposta }}
                </div>
            </div>
        </div>
        <div class="section">
            <h5>Tombamento</h5>
            <div class="row">
                <div class="col s12 l4 m4">
                    <b>Nº Ato</b><br>
                    {{ proposta.nratotombamento }}
                </div>
                <div class="col s12 l4 m4">
                    <b>Dt. Ato</b><br>
                    {{ proposta.dtatotombamentoform }}
                </div>
                <div class="col s12 l4 m4">
                    <b>Esfera</b><br>
                    {{ proposta.esferatombamento }}
                </div>
            </div>
        </div>
    </div>
</script>

<script src="/public/js/vue.js" type="text/javascript"></script>
<script type="text/javascript" src="/public/js/componentes/salic-table-easy.js"></script>

<script type="text/x-template" id="historico-avaliacoes">
    <div class="historico">
        <div class="row">
            <salic-table-easy v-bind:dados="dado"></salic-table-easy>
        </div>
    </div>
</script>

<script type="text/x-template" id="dados-proponente">
    <div id="proponente">
        <div class="section">
            <h5>Endere&ccedil;o</h5>
            <table class="bordered striped responsive-table">
                <tr class="destacar">
                    <td width="10%" nowrap class="centro"><b>Tipo de Endere&ccedil;o</b></td>
                    <td width="10%" nowrap class="centro"><b>Tipo do Logradouro</b></td>
                    <td width="20%" class="centro"><b>Logradouro</b></td>
                    <td class="centro"><b>N&uacute;mero</b></td>
                    <td class="centro"><b>Complemento</b></td>
                    <td class="centro"><b>Bairro</b></td>
                    <td class="centro"><b>Cidade</b></td>
                    <td class="centro"><b>UF</b></td>
                    <td class="centro"><b>CEP</b></td>
                </tr>
                <tr v-for="endereco in proponente.enderecos">
                    <td>{{ endereco.tipoendereco }}</td>
                    <td>{{ endereco.dstipologradouro }}</td>
                    <td>{{ endereco.logradouro }}</td>
                    <td>{{ endereco.numero }}</td>
                    <td>{{ endereco.complemento }}</td>
                    <td>{{ endereco.bairro }}</td>
                    <td>{{ endereco.municipio }}</td>
                    <td>{{ endereco.uf }}</td>
                    <td>{{ endereco.cep }}</td>
                </tr>
            </table>
        </div>

        <div>
            <h5>Telefones</h5>
            <table class="bordered striped responsive-table">
                <tr class="destacar">
                    <td width="10%"><b>Tipo</b></td>
                    <td><b>UF</b></td>
                    <td><b>DDD</b></td>
                    <td><b>N&uacute;mero</b></td>
                    <td><b>Divulgar</b></td>
                </tr>
                <tr v-for="telefone in proponente.telefones">
                    <td>{{ telefone.dstelefone }}</td>
                    <td>{{ telefone.ufsigla }}</td>
                    <td>{{ telefone.ddd }}</td>
                    <td>{{ telefone.numero }}</td>
                    <td>{{ telefone.divulgar }}</td>
                </tr>
            </table>
        </div>

        <div>
            <h5>E-mail</h5>
            <table class="bordered striped responsive-table">
                <tr class="destacar">
                    <td width="10%"><b>Tipo</b></td>
                    <td><b>E-mail</b></td>
                    <td><b>Posso divulgar?</b></td>
                </tr>
                <tr v-for="email in proponente.emails">
                    <td nowrap>{{ email.tipo }}</td>
                    <td nowrap>{{ email.descricao }}</td>
                    <td>{{ email.divulgar }}</td>
                </tr>
            </table>
        </div>

        <div>
            <h5>Natureza</h5>
            <table class="bordered striped responsive-table">
                <tr class="destacar">
                    <td width="10%"><b>Direito</b></td>
                    <td><b>Esfera</b></td>
                    <td><b>Poder</b></td>
                    <td><b>Administra&ccedil;&atilde;o</b></td>
                </tr>
                <tr>
                    <?php if (!empty($this->itensGeral[0]->direito)) { ?>
                        <td nowrap><?php echo $this->itensGeral[0]->direito ?></td>
                        <td><?php echo $this->itensGeral[0]->esfera ?></td>
                        <td><?php echo $this->itensGeral[0]->poder ?></td>
                        <td><?php echo $this->itensGeral[0]->Admins ?></td>
                    <?php } else { ?>
                        <td colspan="4" align="center">Natureza n&atilde;o informada</td>
                    <?php } ?>
                </tr>
            </table>
        </div>

        <div>
            <h5>Dirigente</h5>
            <table class="bordered striped responsive-table">
                <?php if ($this->dirigentes && count($this->dirigentes) > 0) { ?>
                    <tr class="destacar">
                        <td width="20%" align="center"><b>CPF</b></td>
                        <td align="center"><b>Nome</b></td>
                    </tr>
                    <?php foreach ($this->dirigentes as $tbdirigentes): ?>
                        <?php
                        $cpfCnpjDirigente = $tbdirigentes['CNPJCPFDirigente'];
                        $nomeDirigente = $tbdirigentes['NomeDirigente'];

                        if ($cpfCnpjDirigente != '00000000000000'): ?>
                            <tr>
                                <td align="center"><?php echo empty($cpfCnpjDirigente) ? '<em>Dados n&atilde;o informados!</em>' : aplicaMascara($cpfCnpjDirigente, "999.999.999-99"); ?>
                                <td align="left"><?php echo $nomeDirigente; ?></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <table class='bordered striped responsive-table'>
                                        <tr class="destacar">
                                            <td class="centro" colspan="4">Mandatos</td>
                                        </tr>
                                        <?php if (count($this->mandatos[$nomeDirigente]) > 0):
                                            foreach ($this->mandatos[$nomeDirigente] as $mandato): ?>
                                                <tr>
                                                    <td>
                                                        <b>Tipo de documento</b><br>
                                                        <?php echo $mandato->Descricao; ?>
                                                    </td>
                                                    <td>
                                                        <b>N&ordm; do documento</b><br>
                                                        <?php echo $mandato->dsNumeroDocumento; ?>
                                                    </td>
                                                    <td>
                                                        <b>Per&iacute;odo de vig&ecirc;ncia</b><br>
                                                        <?php echo date('d/m/Y', strtotime($mandato->dtInicioMandato)) . ' &agrave; ' . date('d/m/Y', strtotime($mandato->dtFimMandato)); ?>
                                                    </td>
                                                    <td>
                                                        <b>Arquivo</b><br>
                                                        <a href="<?php echo $this->url(array('controller' => 'upload', 'action' => 'abrir')); ?>?id=<?php echo $mandato->idArquivo; ?>"><?php echo $mandato->nmArquivo ?></a>
                                                    </td>
                                                </tr>
                                            <?php endforeach; ?>
                                        <?php else: ?>
                                            <tr>
                                                <td class="centro" colspan="4"><em>N&atilde;o
                                                        existem mandatos cadastrados!</em></td>
                                            </tr>
                                        <?php endif; ?>
                                    </table>
                                </td>
                            </tr>
                        <?php endif; ?>
                    <?php endforeach; ?>
                <?php } else { ?>
                    <tr>
                        <td colspan="2" align="center"><em>N&atilde;o existem Dirigentes
                                cadastrados!</em></td>
                    </tr>
                <?php } ?>
            </table>
        </div>

        <div>
            <h5>Usu&aacute;rio SalicWEB</h5>
            <table class="bordered striped responsive-table">
                <tr>
                    <?php if (is_array($this->itensGeral) and !empty($this->itensGeral[0]->nomeUsuario)) { ?>
                        <td width="10%" class="esquerda"><b>CPF</b></td>
                        <td class="esquerda"><?php echo aplicaMascara($this->itensGeral[0]->Cpf, "999.999.999-99") ?></td>
                        <td width="10%" class="esquerda"><b>Nome</b></td>
                        <td class="esquerda"><?php echo $this->itensGeral[0]->nomeUsuario ?></td>
                    <?php } ?>
                </tr>
            </table>
        </div>
    </div>
</script>

<script type="text/javascript">

    Vue.component('salic-identificacao-proposta', {
        template: '#identificacao-da-proposta',
        data: function () {
            return {
                proposta: []
            }
        },
        props: ['idpreprojeto', 'dados'],
        mounted: function () {
//            if(this.dados) {
//                this.proposta = this.dados;
//            }else {
            this.buscar_dados();
//            }
        },
        methods: {
            buscar_dados: function () {
                let vue = this;
                $3.ajax({
                    url: '/proposta/visualizar/identificacao/idPreProjeto/' + vue.idpreprojeto
                }).done(function (data) {
                    vue.proposta = data.data;
                });
            }
        }
    });


    Vue.component('salic-historico-avaliacoes', {
        template: '#historico-avaliacoes',
        data: function () {
            return {
                dado: []
            }
        },
        props: ['idpreprojeto'],
        mounted: function () {
            this.carregar_historico();
        },
        methods: {
            carregar_historico: function () {
                let vue = this;
                $3.ajax({
                    url: '/proposta/visualizar/historico-avaliacoes/idPreProjeto/' + vue.idpreprojeto
                }).done(function (data) {
                    vue.dado = data.data;
                    vue.dado = {
                        "lines": [
                                {"tipo": "Projeto", "Avaliacao": 'aaaaa'},
                                {"tipo": "Proposta", "Avaliacao": "Proposta Cultural ENVIADA ao Minist&eacute;rio da Cultura para Conformidade Visual"},
                                {"tipo": "Proposta", "Avaliacao": "<p>Proposta admitida.<\/p>"},
                                {"tipo": "Projeto", "Avaliacao": "<p>Ajustar.<\/p>"}
                            ],
                        "cols": ["#", "Avalia&ccedil;&atilde;o"],
                        "title": "Hist&oacute;rico de avalia&ccedil;&otilde;es"
                    }
                });
            }
        }
    });




    new Vue({
        el: '#container'
    })
</script>

